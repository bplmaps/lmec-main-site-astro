---
import Layout from '../../layouts/Layout.astro';
import { useStoryblokApi } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import { fetchEvents, getVersion } from "../../lib/storyblok-fetch";

export async function getStaticPaths() {
  const allEvents = await fetchEvents();

  return allEvents.map((event: any) => {
    return {
      params: {
        slug: event.slug,
      },
    }
  })
}

const { slug } = Astro.params

const storyblokApi = useStoryblokApi()

const { data } = await storyblokApi.get(
  `cdn/stories/main-site/event/${slug}`,
  {
    version: getVersion(),
  }
)
 
const event = (data as any).story
---

<Layout title={`${event.name}`} pill="Event" image={`${event.content.headerImage && event.content.headerImage.filename}`}>
  <StoryblokComponent name={event.name} blok={event.content} tags={event.tag_list} />
</Layout>
