---
import Layout from '../../layouts/Layout.astro';
import { useStoryblokApi } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import { fetchArticles, getVersion } from "../../lib/storyblok-fetch";

export async function getStaticPaths() {
  const allArticles = await fetchArticles();

  return allArticles.map((article: any) => {
    return {
      params: {
        slug: article.slug,
      },
    }
  })
}

const { slug } = Astro.params

const storyblokApi = useStoryblokApi()

const { data } = await storyblokApi.get(
  `cdn/stories/main-site/articles/${slug}`,
  {
    version: getVersion(),
  }
)
 
const article = (data as any).story
---

<Layout title={`${article.name}`} description={`${article.content.description}`} pill="Article" subheading={`${article.content.description}`} image={`${article.content.headerImage && article.content.headerImage.filename}`}>
  <StoryblokComponent name={article.name} blok={article.content} tags={article.tag_list}/>
</Layout>
