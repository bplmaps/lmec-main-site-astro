---
import { fetchLatestArticles } from "../../lib/storyblok-fetch";

export interface Props {
	tags: string[];
}

const { tags } = Astro.props;
const sidebarArticles = await fetchLatestArticles(4);
---

{tags &&
  <div class="bg-white mb-5">
    <h4 class="mb-4">Tags</h4>
    <p>
      {tags.map((tag: string) => (
        <span class="badge rounded-pill bg-light text-secondary mb-1 tag-list">
          <a href=`/tags/${tag.replace(/\s+/g, '-').toLowerCase()}`>{tag}</a>
        </span>
      ))}
    </p>
  </div>
}

{sidebarArticles &&
  <div class="bg-white">
    <h4 class="mb-4">Recent Articles</h4>
    {sidebarArticles.map((article: any) => (
      <div class="d-flex mb-4">
        {article.content.headerImage && article.content.headerImage.filename &&
          <div class="flex-shrink-0">
            <a href={`/articles/${article.slug}`}>
              <img src={article.content.headerImage.filename} alt={`Thumbnail image for article ${article.name}`} class="post-thumb-sm">
            </a>
          </div>
        }
        <div class="flex-grow-1 ms-3">
          <a href=`/articles/${article.slug}`>
            {article.name &&
              <h5 class="mt-0">
                {article.name}
              </h5>
            }
          </a>

          {article.content.publishDate &&
            new Date(article.content.publishDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric'})
          }
        </div>
      </div>
    ))}
  </div>
}